{% extends 'base.html' %}
{% load static %}

{% block blocktitle %}Личный кабинет{% endblock %}

{% block content %}
<main>
    <div class="container">
        <h1>Личный кабинет</h1>
        <p>Добро пожаловать, {{ request.user.full_name }}!</p>

        <div style="margin: 20px 0;">
            <a href="{% url 'create_application' %}" class="btn btn-primary">Подать новую заявку</a>
        </div>

        <h2>Мои заявки</h2>
        
        {% if applications %}
           <table border="1" style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr>
            <th>Фото</th>
            <th>Марка</th>
            <th>Модель</th>
            <th>Год</th>
            <th>Двигатель</th>
            <th>Статус</th>
            <th>Дата</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for app in applications %}
        <tr>
            <td>
                {% if app.car_photo %}
                    <img src="{{ app.car_photo.url }}" alt="{{ app.car_brand }}" style="width: 50px; height: 50px; object-fit: cover;">
                {% else %}
                    <span>Нет фото</span>
                {% endif %}
            </td>
            <td>{{ app.car_brand }}</td>
            <td>{{ app.car_model }}</td>
            <td>{{ app.car_year }}</td>
            <td>{{ app.engine_volume }} л</td>
            <td>
                {% if app.status == 'pending' %}
                    <span style="color: orange;">На рассмотрении</span>
                {% elif app.status == 'approved' %}
                    <span style="color: green;">Одобрено</span>
                {% else %}
                    <span style="color: red;">Отклонено</span>
                {% endif %}
            </td>
            <td>{{ app.created_at|date:"d.m.Y" }}</td>
            <td>
                <a href="{% url 'update_application' app.pk %}">Редактировать</a>
                <a href="{% url 'delete_application' app.pk %}" style="color: red; margin-left: 10px;">Удалить</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
        {% else %}
            <p>У вас пока нет заявок.</p>
        {% endif %}
    </div>
</main>
{% endblock %}